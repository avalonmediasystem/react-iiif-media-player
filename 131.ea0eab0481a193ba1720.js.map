{"version":3,"sources":["webpack:///./node_modules/iiif-explorer/dist/esm-es5/ion-virtual-scroll.entry.js"],"names":["__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","apply","__generator","body","f","y","t","g","_","label","sent","trys","ops","verb","Symbol","iterator","this","n","v","op","TypeError","call","pop","length","push","createNode","el","type","template","getTemplate","ownerDocument","importNode","content","children","querySelector","calcCells","items","itemHeight","headerHeight","footerHeight","headerFn","footerFn","approxHeaderHeight","approxFooterHeight","approxItemHeight","j","offset","len","cells","end","i","item","index","height","reads","visible","VirtualScroll","class_1","hostRef","_this","range","viewportHeight","virtualDom","isEnabled","viewportOffset","currentScrollTop","indexDirty","lastItemLen","totalHeight","onScroll","updateVirtualScroll","prototype","itemsChanged","connectedCallback","contentEl","_a","_b","closest","getScrollElement","console","error","scrollEl","updateState","componentDidUpdate","disconnectedCallback","undefined","onResize","positionForItem","heightIndex","cell","find","c","positionForIndex","getHeightIndex","checkRange","cellIndex","max","findIndex","findCellIndex","dst","src","inplaceUpdate","Math","scheduleUpdate","checkEnd","timerUpdate","clearTimeout","readVS","bind","writeVS","topOffset","node","offsetTop","parentElement","offsetHeight","scrollTop","dirtyIndex","viewport","vierportHeight","margin","top","bottom","getViewport","buffer","topPos","bottomPos","min","getRange","currentRange","getShouldUpdate","dom","_i","dom_1","change","d","toMutate","_loop_1","pool","filter","_loop_2","toMutate_1","forEach","updateVDom","nodeRender","updateCellHeight","child","Array","from","tagName","childrenNu","newChild","classList","add","appendChild","style","transform","remove","doRender","domRender","renderItem","forceUpdate","update","window","getComputedStyle","parseFloat","getPropertyValue","setCellHeight","componentOnReady","setTimeout","shouldEnable","enableScrollEvents","Infinity","calcHeightIndex","buf","Uint32Array","newBuf","set","subarray","resizeBuffer","acum","shouldListen","rmEvent","addEventListener","removeEventListener","renderVirtualNode","renderHeader","renderFooter","render","VirtualProxy","map","Object","defineProperty","get","enumerable","configurable","utils","vattrs","classes","class","assign"],"mappings":"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","file":"131.ea0eab0481a193ba1720.js","sourcesContent":["var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __generator = (this && this.__generator) || function (thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n};\r\nimport { r as registerInstance, f as readTask, w as writeTask, h, H as Host, d as getElement } from './core-0428d3c8.js';\r\nvar CELL_TYPE_ITEM = 'item';\r\nvar CELL_TYPE_HEADER = 'header';\r\nvar CELL_TYPE_FOOTER = 'footer';\r\nvar NODE_CHANGE_NONE = 0;\r\nvar NODE_CHANGE_POSITION = 1;\r\nvar NODE_CHANGE_CELL = 2;\r\nvar MIN_READS = 2;\r\nvar updateVDom = function (dom, heightIndex, cells, range) {\r\n    // reset dom\r\n    for (var _i = 0, dom_1 = dom; _i < dom_1.length; _i++) {\r\n        var node = dom_1[_i];\r\n        node.change = NODE_CHANGE_NONE;\r\n        node.d = true;\r\n    }\r\n    // try to match into exisiting dom\r\n    var toMutate = [];\r\n    var end = range.offset + range.length;\r\n    var _loop_1 = function (i) {\r\n        var cell = cells[i];\r\n        var node = dom.find(function (n) { return n.d && n.cell === cell; });\r\n        if (node) {\r\n            var top = heightIndex[i];\r\n            if (top !== node.top) {\r\n                node.top = top;\r\n                node.change = NODE_CHANGE_POSITION;\r\n            }\r\n            node.d = false;\r\n        }\r\n        else {\r\n            toMutate.push(cell);\r\n        }\r\n    };\r\n    for (var i = range.offset; i < end; i++) {\r\n        _loop_1(i);\r\n    }\r\n    // needs to append\r\n    var pool = dom.filter(function (n) { return n.d; });\r\n    var _loop_2 = function (cell) {\r\n        var node = pool.find(function (n) { return n.d && n.cell.type === cell.type; });\r\n        var index = cell.i;\r\n        if (node) {\r\n            node.d = false;\r\n            node.change = NODE_CHANGE_CELL;\r\n            node.cell = cell;\r\n            node.top = heightIndex[index];\r\n        }\r\n        else {\r\n            dom.push({\r\n                d: false,\r\n                cell: cell,\r\n                visible: true,\r\n                change: NODE_CHANGE_CELL,\r\n                top: heightIndex[index],\r\n            });\r\n        }\r\n    };\r\n    for (var _a = 0, toMutate_1 = toMutate; _a < toMutate_1.length; _a++) {\r\n        var cell = toMutate_1[_a];\r\n        _loop_2(cell);\r\n    }\r\n    dom\r\n        .filter(function (n) { return n.d && n.top !== -9999; })\r\n        .forEach(function (n) {\r\n        n.change = NODE_CHANGE_POSITION;\r\n        n.top = -9999;\r\n    });\r\n};\r\nvar doRender = function (el, nodeRender, dom, updateCellHeight) {\r\n    var children = Array.from(el.children).filter(function (n) { return n.tagName !== 'TEMPLATE'; });\r\n    var childrenNu = children.length;\r\n    var child;\r\n    for (var i = 0; i < dom.length; i++) {\r\n        var node = dom[i];\r\n        var cell = node.cell;\r\n        // the cell change, the content must be updated\r\n        if (node.change === NODE_CHANGE_CELL) {\r\n            if (i < childrenNu) {\r\n                child = children[i];\r\n                nodeRender(child, cell, i);\r\n            }\r\n            else {\r\n                var newChild = createNode(el, cell.type);\r\n                child = nodeRender(newChild, cell, i) || newChild;\r\n                child.classList.add('virtual-item');\r\n                el.appendChild(child);\r\n            }\r\n            child['$ionCell'] = cell;\r\n        }\r\n        else {\r\n            child = children[i];\r\n        }\r\n        // only update position when it changes\r\n        if (node.change !== NODE_CHANGE_NONE) {\r\n            child.style.transform = \"translate3d(0,\" + node.top + \"px,0)\";\r\n        }\r\n        // update visibility\r\n        var visible = cell.visible;\r\n        if (node.visible !== visible) {\r\n            if (visible) {\r\n                child.classList.remove('virtual-loading');\r\n            }\r\n            else {\r\n                child.classList.add('virtual-loading');\r\n            }\r\n            node.visible = visible;\r\n        }\r\n        // dynamic height\r\n        if (cell.reads > 0) {\r\n            updateCellHeight(cell, child);\r\n            cell.reads--;\r\n        }\r\n    }\r\n};\r\nvar createNode = function (el, type) {\r\n    var template = getTemplate(el, type);\r\n    if (template && el.ownerDocument) {\r\n        return el.ownerDocument.importNode(template.content, true).children[0];\r\n    }\r\n    return null;\r\n};\r\nvar getTemplate = function (el, type) {\r\n    switch (type) {\r\n        case CELL_TYPE_ITEM: return el.querySelector('template:not([name])');\r\n        case CELL_TYPE_HEADER: return el.querySelector('template[name=header]');\r\n        case CELL_TYPE_FOOTER: return el.querySelector('template[name=footer]');\r\n    }\r\n};\r\nvar getViewport = function (scrollTop, vierportHeight, margin) {\r\n    return {\r\n        top: Math.max(scrollTop - margin, 0),\r\n        bottom: scrollTop + vierportHeight + margin\r\n    };\r\n};\r\nvar getRange = function (heightIndex, viewport, buffer) {\r\n    var topPos = viewport.top;\r\n    var bottomPos = viewport.bottom;\r\n    // find top index\r\n    var i = 0;\r\n    for (; i < heightIndex.length; i++) {\r\n        if (heightIndex[i] > topPos) {\r\n            break;\r\n        }\r\n    }\r\n    var offset = Math.max(i - buffer - 1, 0);\r\n    // find bottom index\r\n    for (; i < heightIndex.length; i++) {\r\n        if (heightIndex[i] >= bottomPos) {\r\n            break;\r\n        }\r\n    }\r\n    var end = Math.min(i + buffer, heightIndex.length);\r\n    var length = end - offset;\r\n    return { offset: offset, length: length };\r\n};\r\nvar getShouldUpdate = function (dirtyIndex, currentRange, range) {\r\n    var end = range.offset + range.length;\r\n    return (dirtyIndex <= end ||\r\n        currentRange.offset !== range.offset ||\r\n        currentRange.length !== range.length);\r\n};\r\nvar findCellIndex = function (cells, index) {\r\n    var max = cells.length > 0 ? cells[cells.length - 1].index : 0;\r\n    if (index === 0) {\r\n        return 0;\r\n    }\r\n    else if (index === max + 1) {\r\n        return cells.length;\r\n    }\r\n    else {\r\n        return cells.findIndex(function (c) { return c.index === index; });\r\n    }\r\n};\r\nvar inplaceUpdate = function (dst, src, offset) {\r\n    if (offset === 0 && src.length >= dst.length) {\r\n        return src;\r\n    }\r\n    for (var i = 0; i < src.length; i++) {\r\n        dst[i + offset] = src[i];\r\n    }\r\n    return dst;\r\n};\r\nvar calcCells = function (items, itemHeight, headerHeight, footerHeight, headerFn, footerFn, approxHeaderHeight, approxFooterHeight, approxItemHeight, j, offset, len) {\r\n    var cells = [];\r\n    var end = len + offset;\r\n    for (var i = offset; i < end; i++) {\r\n        var item = items[i];\r\n        if (headerFn) {\r\n            var value = headerFn(item, i, items);\r\n            if (value != null) {\r\n                cells.push({\r\n                    i: j++,\r\n                    type: CELL_TYPE_HEADER,\r\n                    value: value,\r\n                    index: i,\r\n                    height: headerHeight ? headerHeight(value, i) : approxHeaderHeight,\r\n                    reads: headerHeight ? 0 : MIN_READS,\r\n                    visible: !!headerHeight,\r\n                });\r\n            }\r\n        }\r\n        cells.push({\r\n            i: j++,\r\n            type: CELL_TYPE_ITEM,\r\n            value: item,\r\n            index: i,\r\n            height: itemHeight ? itemHeight(item, i) : approxItemHeight,\r\n            reads: itemHeight ? 0 : MIN_READS,\r\n            visible: !!itemHeight,\r\n        });\r\n        if (footerFn) {\r\n            var value = footerFn(item, i, items);\r\n            if (value != null) {\r\n                cells.push({\r\n                    i: j++,\r\n                    type: CELL_TYPE_FOOTER,\r\n                    value: value,\r\n                    index: i,\r\n                    height: footerHeight ? footerHeight(value, i) : approxFooterHeight,\r\n                    reads: footerHeight ? 0 : MIN_READS,\r\n                    visible: !!footerHeight,\r\n                });\r\n            }\r\n        }\r\n    }\r\n    return cells;\r\n};\r\nvar calcHeightIndex = function (buf, cells, index) {\r\n    var acum = buf[index];\r\n    for (var i = index; i < buf.length; i++) {\r\n        buf[i] = acum;\r\n        acum += cells[i].height;\r\n    }\r\n    return acum;\r\n};\r\nvar resizeBuffer = function (buf, len) {\r\n    if (!buf) {\r\n        return new Uint32Array(len);\r\n    }\r\n    if (buf.length === len) {\r\n        return buf;\r\n    }\r\n    else if (len > buf.length) {\r\n        var newBuf = new Uint32Array(len);\r\n        newBuf.set(buf);\r\n        return newBuf;\r\n    }\r\n    else {\r\n        return buf.subarray(0, len);\r\n    }\r\n};\r\nvar positionForIndex = function (index, cells, heightIndex) {\r\n    var cell = cells.find(function (c) { return c.type === CELL_TYPE_ITEM && c.index === index; });\r\n    if (cell) {\r\n        return heightIndex[cell.i];\r\n    }\r\n    return -1;\r\n};\r\nvar VirtualScroll = /** @class */ (function () {\r\n    function class_1(hostRef) {\r\n        var _this = this;\r\n        registerInstance(this, hostRef);\r\n        this.range = { offset: 0, length: 0 };\r\n        this.viewportHeight = 0;\r\n        this.cells = [];\r\n        this.virtualDom = [];\r\n        this.isEnabled = false;\r\n        this.viewportOffset = 0;\r\n        this.currentScrollTop = 0;\r\n        this.indexDirty = 0;\r\n        this.lastItemLen = 0;\r\n        this.totalHeight = 0;\r\n        /**\r\n         * It is important to provide this\r\n         * if virtual item height will be significantly larger than the default\r\n         * The approximate height of each virtual item template's cell.\r\n         * This dimension is used to help determine how many cells should\r\n         * be created when initialized, and to help calculate the height of\r\n         * the scrollable area. This height value can only use `px` units.\r\n         * Note that the actual rendered size of each cell comes from the\r\n         * app's CSS, whereas this approximation is used to help calculate\r\n         * initial dimensions before the item has been rendered.\r\n         */\r\n        this.approxItemHeight = 45;\r\n        /**\r\n         * The approximate height of each header template's cell.\r\n         * This dimension is used to help determine how many cells should\r\n         * be created when initialized, and to help calculate the height of\r\n         * the scrollable area. This height value can only use `px` units.\r\n         * Note that the actual rendered size of each cell comes from the\r\n         * app's CSS, whereas this approximation is used to help calculate\r\n         * initial dimensions before the item has been rendered.\r\n         */\r\n        this.approxHeaderHeight = 30;\r\n        /**\r\n         * The approximate width of each footer template's cell.\r\n         * This dimension is used to help determine how many cells should\r\n         * be created when initialized, and to help calculate the height of\r\n         * the scrollable area. This height value can only use `px` units.\r\n         * Note that the actual rendered size of each cell comes from the\r\n         * app's CSS, whereas this approximation is used to help calculate\r\n         * initial dimensions before the item has been rendered.\r\n         */\r\n        this.approxFooterHeight = 30;\r\n        this.onScroll = function () {\r\n            _this.updateVirtualScroll();\r\n        };\r\n    }\r\n    class_1.prototype.itemsChanged = function () {\r\n        this.calcCells();\r\n        this.updateVirtualScroll();\r\n    };\r\n    class_1.prototype.connectedCallback = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var contentEl, _a;\r\n            return __generator(this, function (_b) {\r\n                switch (_b.label) {\r\n                    case 0:\r\n                        contentEl = this.el.closest('ion-content');\r\n                        if (!contentEl) {\r\n                            console.error('<ion-virtual-scroll> must be used inside an <ion-content>');\r\n                            return [2 /*return*/];\r\n                        }\r\n                        _a = this;\r\n                        return [4 /*yield*/, contentEl.getScrollElement()];\r\n                    case 1:\r\n                        _a.scrollEl = _b.sent();\r\n                        this.contentEl = contentEl;\r\n                        this.calcCells();\r\n                        this.updateState();\r\n                        return [2 /*return*/];\r\n                }\r\n            });\r\n        });\r\n    };\r\n    class_1.prototype.componentDidUpdate = function () {\r\n        this.updateState();\r\n    };\r\n    class_1.prototype.disconnectedCallback = function () {\r\n        this.scrollEl = undefined;\r\n    };\r\n    class_1.prototype.onResize = function () {\r\n        this.calcCells();\r\n        this.updateVirtualScroll();\r\n    };\r\n    /**\r\n     * Returns the position of the virtual item at the given index.\r\n     */\r\n    class_1.prototype.positionForItem = function (index) {\r\n        return Promise.resolve(positionForIndex(index, this.cells, this.getHeightIndex()));\r\n    };\r\n    /**\r\n     * This method marks a subset of items as dirty, so they can be re-rendered. Items should be marked as\r\n     * dirty any time the content or their style changes.\r\n     *\r\n     * The subset of items to be updated can are specifing by an offset and a length.\r\n     */\r\n    class_1.prototype.checkRange = function (offset, len) {\r\n        if (len === void 0) { len = -1; }\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            var length, cellIndex, cells;\r\n            return __generator(this, function (_a) {\r\n                // TODO: kind of hacky how we do in-place updated of the cells\r\n                // array. this part needs a complete refactor\r\n                if (!this.items) {\r\n                    return [2 /*return*/];\r\n                }\r\n                length = (len === -1)\r\n                    ? this.items.length - offset\r\n                    : len;\r\n                cellIndex = findCellIndex(this.cells, offset);\r\n                cells = calcCells(this.items, this.itemHeight, this.headerHeight, this.footerHeight, this.headerFn, this.footerFn, this.approxHeaderHeight, this.approxFooterHeight, this.approxItemHeight, cellIndex, offset, length);\r\n                this.cells = inplaceUpdate(this.cells, cells, cellIndex);\r\n                this.lastItemLen = this.items.length;\r\n                this.indexDirty = Math.max(offset - 1, 0);\r\n                this.scheduleUpdate();\r\n                return [2 /*return*/];\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * This method marks the tail the items array as dirty, so they can be re-rendered.\r\n     *\r\n     * It's equivalent to calling:\r\n     *\r\n     * ```js\r\n     * virtualScroll.checkRange(lastItemLen);\r\n     * ```\r\n     */\r\n    class_1.prototype.checkEnd = function () {\r\n        return __awaiter(this, void 0, void 0, function () {\r\n            return __generator(this, function (_a) {\r\n                if (this.items) {\r\n                    this.checkRange(this.lastItemLen);\r\n                }\r\n                return [2 /*return*/];\r\n            });\r\n        });\r\n    };\r\n    class_1.prototype.updateVirtualScroll = function () {\r\n        // do nothing if virtual-scroll is disabled\r\n        if (!this.isEnabled || !this.scrollEl) {\r\n            return;\r\n        }\r\n        // unschedule future updates\r\n        if (this.timerUpdate) {\r\n            clearTimeout(this.timerUpdate);\r\n            this.timerUpdate = undefined;\r\n        }\r\n        // schedule DOM operations into the stencil queue\r\n        readTask(this.readVS.bind(this));\r\n        writeTask(this.writeVS.bind(this));\r\n    };\r\n    class_1.prototype.readVS = function () {\r\n        var _a = this, contentEl = _a.contentEl, scrollEl = _a.scrollEl, el = _a.el;\r\n        var topOffset = 0;\r\n        var node = el;\r\n        while (node && node !== contentEl) {\r\n            topOffset += node.offsetTop;\r\n            node = node.parentElement;\r\n        }\r\n        this.viewportOffset = topOffset;\r\n        if (scrollEl) {\r\n            this.viewportHeight = scrollEl.offsetHeight;\r\n            this.currentScrollTop = scrollEl.scrollTop;\r\n        }\r\n    };\r\n    class_1.prototype.writeVS = function () {\r\n        var dirtyIndex = this.indexDirty;\r\n        // get visible viewport\r\n        var scrollTop = this.currentScrollTop - this.viewportOffset;\r\n        var viewport = getViewport(scrollTop, this.viewportHeight, 100);\r\n        // compute lazily the height index\r\n        var heightIndex = this.getHeightIndex();\r\n        // get array bounds of visible cells base in the viewport\r\n        var range = getRange(heightIndex, viewport, 2);\r\n        // fast path, do nothing\r\n        var shouldUpdate = getShouldUpdate(dirtyIndex, this.range, range);\r\n        if (!shouldUpdate) {\r\n            return;\r\n        }\r\n        this.range = range;\r\n        // in place mutation of the virtual DOM\r\n        updateVDom(this.virtualDom, heightIndex, this.cells, range);\r\n        // Write DOM\r\n        // Different code paths taken depending of the render API used\r\n        if (this.nodeRender) {\r\n            doRender(this.el, this.nodeRender, this.virtualDom, this.updateCellHeight.bind(this));\r\n        }\r\n        else if (this.domRender) {\r\n            this.domRender(this.virtualDom);\r\n        }\r\n        else if (this.renderItem) {\r\n            this.el.forceUpdate();\r\n        }\r\n    };\r\n    class_1.prototype.updateCellHeight = function (cell, node) {\r\n        var _this = this;\r\n        var update = function () {\r\n            if (node['$ionCell'] === cell) {\r\n                var style = window.getComputedStyle(node);\r\n                var height = node.offsetHeight + parseFloat(style.getPropertyValue('margin-bottom'));\r\n                _this.setCellHeight(cell, height);\r\n            }\r\n        };\r\n        if (node && node.componentOnReady) {\r\n            node.componentOnReady().then(update);\r\n        }\r\n        else {\r\n            update();\r\n        }\r\n    };\r\n    class_1.prototype.setCellHeight = function (cell, height) {\r\n        var index = cell.i;\r\n        // the cell might changed since the height update was scheduled\r\n        if (cell !== this.cells[index]) {\r\n            return;\r\n        }\r\n        if (cell.height !== height || cell.visible !== true) {\r\n            cell.visible = true;\r\n            cell.height = height;\r\n            this.indexDirty = Math.min(this.indexDirty, index);\r\n            this.scheduleUpdate();\r\n        }\r\n    };\r\n    class_1.prototype.scheduleUpdate = function () {\r\n        var _this = this;\r\n        clearTimeout(this.timerUpdate);\r\n        this.timerUpdate = setTimeout(function () { return _this.updateVirtualScroll(); }, 100);\r\n    };\r\n    class_1.prototype.updateState = function () {\r\n        var shouldEnable = !!(this.scrollEl &&\r\n            this.cells);\r\n        if (shouldEnable !== this.isEnabled) {\r\n            this.enableScrollEvents(shouldEnable);\r\n            if (shouldEnable) {\r\n                this.updateVirtualScroll();\r\n            }\r\n        }\r\n    };\r\n    class_1.prototype.calcCells = function () {\r\n        if (!this.items) {\r\n            return;\r\n        }\r\n        this.lastItemLen = this.items.length;\r\n        this.cells = calcCells(this.items, this.itemHeight, this.headerHeight, this.footerHeight, this.headerFn, this.footerFn, this.approxHeaderHeight, this.approxFooterHeight, this.approxItemHeight, 0, 0, this.lastItemLen);\r\n        this.indexDirty = 0;\r\n    };\r\n    class_1.prototype.getHeightIndex = function () {\r\n        if (this.indexDirty !== Infinity) {\r\n            this.calcHeightIndex(this.indexDirty);\r\n        }\r\n        return this.heightIndex;\r\n    };\r\n    class_1.prototype.calcHeightIndex = function (index) {\r\n        if (index === void 0) { index = 0; }\r\n        // TODO: optimize, we don't need to calculate all the cells\r\n        this.heightIndex = resizeBuffer(this.heightIndex, this.cells.length);\r\n        this.totalHeight = calcHeightIndex(this.heightIndex, this.cells, index);\r\n        this.indexDirty = Infinity;\r\n    };\r\n    class_1.prototype.enableScrollEvents = function (shouldListen) {\r\n        var _this = this;\r\n        if (this.rmEvent) {\r\n            this.rmEvent();\r\n            this.rmEvent = undefined;\r\n        }\r\n        var scrollEl = this.scrollEl;\r\n        if (scrollEl) {\r\n            this.isEnabled = shouldListen;\r\n            scrollEl.addEventListener('scroll', this.onScroll);\r\n            this.rmEvent = function () {\r\n                scrollEl.removeEventListener('scroll', _this.onScroll);\r\n            };\r\n        }\r\n    };\r\n    class_1.prototype.renderVirtualNode = function (node) {\r\n        var _a = node.cell, type = _a.type, value = _a.value, index = _a.index;\r\n        switch (type) {\r\n            case CELL_TYPE_ITEM: return this.renderItem(value, index);\r\n            case CELL_TYPE_HEADER: return this.renderHeader(value, index);\r\n            case CELL_TYPE_FOOTER: return this.renderFooter(value, index);\r\n        }\r\n    };\r\n    class_1.prototype.render = function () {\r\n        var _this = this;\r\n        return (h(Host, { style: {\r\n                height: this.totalHeight + \"px\"\r\n            } }, this.renderItem && (h(VirtualProxy, { dom: this.virtualDom }, this.virtualDom.map(function (node) { return _this.renderVirtualNode(node); })))));\r\n    };\r\n    Object.defineProperty(class_1.prototype, \"el\", {\r\n        get: function () { return getElement(this); },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(class_1, \"watchers\", {\r\n        get: function () {\r\n            return {\r\n                \"itemHeight\": [\"itemsChanged\"],\r\n                \"headerHeight\": [\"itemsChanged\"],\r\n                \"footerHeight\": [\"itemsChanged\"],\r\n                \"items\": [\"itemsChanged\"]\r\n            };\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(class_1, \"style\", {\r\n        get: function () { return \"ion-virtual-scroll{display:block;position:relative;width:100%;contain:strict;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}ion-virtual-scroll>.virtual-loading{opacity:0}ion-virtual-scroll>.virtual-item{position:absolute!important;top:0!important;right:0!important;left:0!important;-webkit-transition-duration:0ms;transition-duration:0ms;will-change:transform}\"; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    return class_1;\r\n}());\r\nvar VirtualProxy = function (_a, children, utils) {\r\n    var dom = _a.dom;\r\n    return utils.map(children, function (child, i) {\r\n        var node = dom[i];\r\n        var vattrs = child.vattrs || {};\r\n        var classes = vattrs.class || '';\r\n        classes += 'virtual-item ';\r\n        if (!node.visible) {\r\n            classes += 'virtual-loading';\r\n        }\r\n        return Object.assign(Object.assign({}, child), { vattrs: Object.assign(Object.assign({}, vattrs), { class: classes, style: Object.assign(Object.assign({}, vattrs.style), { transform: \"translate3d(0,\" + node.top + \"px,0)\" }) }) });\r\n    });\r\n};\r\nexport { VirtualScroll as ion_virtual_scroll };\r\n"],"sourceRoot":""}